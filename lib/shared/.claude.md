# Shared Module - Reusable Components

**Purpose**: Widgets, models, and utilities used by multiple modules

## Widget Guidelines

**All shared widgets must**:
- Accept required parameters (no defaults hiding complexity)
- Handle null cases gracefully
- Work in both light and dark themes
- Be smaller than 200 lines (split if larger)
- Have optional `onPressed`/`onChanged` callbacks

**Widget Categories**:

### State Widgets (for screen states)
```
EmptyStateWidget      ← No data, with optional action button
ErrorStateWidget      ← Error display with retry
LoadingOverlay        ← Spinner with optional message
```

**Usage**:
```dart
AsyncValue.when(
  loading: () => LoadingOverlay(message: 'Loading...'),
  error: (e, st) => ErrorStateWidget(error: '$e', onRetry: () => ref.refresh(...)),
  data: (data) => data.isEmpty
    ? EmptyStateWidget(...)
    : MyList(data),
)
```

### Input Widgets
```
TextFieldValidators (utilities, not widgets)
  - validateRequired()
  - validateNumeric()
  - validateDate()
  - validateEmail()
```

**Usage in form**:
```dart
TextFormField(
  validator: (value) => FormValidators.validateRequired(value),
  onChanged: (value) => state = value,
)
```

### Display Widgets
```
AppScaffold             ← ShellRoute body wrapper + BottomNavBar
BottomNavBar            ← 5-tab navigation
SearchBarWidget (TODO)  ← Tap to navigate to /search
```

## Adding a Shared Widget

1. Create in `lib/shared/widgets/{name}.dart`
2. Keep under 200 lines
3. Make it reusable (accept all variants as parameters)
4. Test in both light/dark themes
5. Document parameters in code
6. Add to appropriate folder:
   ```
   widgets/
   ├── state_widgets/    ← EmptyState, ErrorState, LoadingOverlay
   ├── form_widgets/     ← Input fields, validators (TODO structure)
   ├── display_widgets/  ← Cards, chips, badges (TODO)
   └── app_scaffold/     ← Navigation wrapper
   ```

## Models

**PaginatedResult** (for pagination):
```dart
class PaginatedResult<T> {
  final List<T> items;
  final int page;
  final int pageSize;
  final int totalItems;
  
  bool get hasMore => (page * pageSize) < totalItems;
}
```

**Usage**:
```dart
// In datasource
List<Goal> getGoalsPage(int page, int pageSize) {
  final offset = (page - 1) * pageSize;
  final results = await database.query(..., limit: pageSize, offset: offset);
  return PaginatedResult(
    items: results,
    page: page,
    pageSize: pageSize,
    totalItems: totalCount,
  );
}

// In screen
ListView.builder(
  itemCount: paginated.items.length,
  itemBuilder: (_, i) {
    if (i == paginated.items.length - 1 && paginated.hasMore) {
      // Load next page
      ref.watch(provider).whenData((data) {
        ref.read(pageProvider.notifier).state++;
      });
    }
    return ItemCard(paginated.items[i]);
  },
)
```

## Search Utilities

**Global Search Integration**:
```
search/
├── global_search_screen.dart  ← Full-screen search UI
├── search_result_model.dart   ← Result factory
└── search_delegate.dart       ← SearchDelegate for in-app search
```

**Using SearchDelegate**:
```dart
showSearch(
  context: context,
  delegate: AppSearchDelegate(ref: ref),
)
```

## Extension Methods

**Where to add**:
```
extensions/
├── datetime_extension.dart   ← toDateString(), weekRange()
├── string_extension.dart
└── list_extension.dart
```

**Example**:
```dart
// extension in datetime_extension.dart
extension DateTimeX on DateTime {
  String toDateString() => '$year-${month.toString().padLeft(2, '0')}-${day.toString().padLeft(2, '0')}';
  
  DateTimeRange weekRange() => DateTimeRange(
    start: subtract(Duration(days: weekday - 1)),
    end: add(Duration(days: 7 - weekday)),
  );
}

// Usage anywhere
final dateStr = DateTime.now().toDateString();
final week = DateTime.now().weekRange();
```

## Testing Shared Components

```bash
# Test widget rendering
flutter test test/shared/widgets/empty_state_widget_test.dart

# Test validators
flutter test test/core/utils/form_validators_test.dart

# Test extensions
flutter test test/core/extensions/datetime_extension_test.dart
```

---

**Keep shared components minimal and reusable!**
